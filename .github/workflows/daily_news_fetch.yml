# å·¥ä½œæµåç§°
name: Fetch Daily AI News (Chinese Only)

# è§¦å‘æ¡ä»¶
on:
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # å®šæ—¶è§¦å‘ï¼šæ¯å¤© 07:00 (UTC)
  # æ³¨æ„ï¼šGitHub Pages æ‰€åœ¨çš„æ—¶åŒºæ˜¯ UTCï¼Œæ‰€ä»¥ 07:00 UTC å¯¹åº”
  # åŒ—äº¬/ä¸Šæµ·æ—¶é—´ (UTC+8) çš„ä¸‹åˆ 15:00ã€‚
  # å¦‚æœä½ å¸Œæœ›åœ¨åŒ—äº¬æ—¶é—´æ—©ä¸Š7ç‚¹è¿è¡Œï¼Œcron åº”è®¾ç½®ä¸º '23 0 * * *' (å³å‰ä¸€å¤©çš„ 23:00 UTC)
  # æˆ‘ä»¬è¿™é‡Œæš‚æ—¶å…ˆç”¨ '0 7 * * *' (UTC 7ç‚¹)
  schedule:
    - cron: '0 7 * * *'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      # æ­¥éª¤2ï¼šè®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # æ­¥éª¤3ï¼šå®‰è£…ä¾èµ– (å·²ç®€åŒ–)
      # åªéœ€è¦ 'requests' æ¥å‘ API è¯·æ±‚
      # 'PyYAML' ç”¨äºå†™å…¥ Jekyll æ•°æ®æ–‡ä»¶
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests PyYAML

      # æ­¥éª¤4ï¼šè¿è¡Œ Python è„šæœ¬
      # æ³¨æ„ï¼šenv ä¸­åªä¼ å…¥äº† NEWS_API_KEY
      - name: Run script to fetch news
        run: python ./_scripts/fetch_news.py
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}

      # æ­¥éª¤5ï¼šæäº¤æ›´æ”¹
      # è„šæœ¬ä¼šç”Ÿæˆ _data/news.ymlï¼Œæ­¤æ­¥éª¤å°†å…¶æäº¤å›ä»“åº“
      - name: Commit and push if changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add _data/news.yml # è¿½è¸ªæ•°æ®æ–‡ä»¶
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŠ¨
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ“° [Bot] Update daily Chinese AI news"
            git push
          else
            echo "No changes to commit."
          fi
