# å·¥ä½œæµåç§°
name: Fetch Daily AI News (Chinese Only)

# è§¦å‘æ¡ä»¶
on:
  workflow_dispatch:
  schedule:
    - cron: '0 7 * * *' # æ¯å¤© 07:00 (UTC)

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    # --- å…³é”®ä¿®æ”¹ï¼šæ·»åŠ åœ¨è¿™é‡Œ ---
    # æ˜ç¡®æˆäºˆæ­¤ä»»åŠ¡(job)å‘ä»“åº“å†™å…¥å†…å®¹çš„æƒé™
    permissions:
      contents: write
    # --- ä¿®æ”¹ç»“æŸ ---
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      # æ­¥éª¤2ï¼šè®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests PyYAML

      # æ­¥éª¤4ï¼šè¿è¡Œ Python è„šæœ¬
      - name: Run script to fetch news
        run: python ./_scripts/fetch_news.py
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}

      # æ­¥éª¤5ï¼šæäº¤æ›´æ”¹ (è¿™ä¸€æ­¥ç°åœ¨åº”è¯¥æœ‰æƒé™äº†)
      - name: Commit and push if changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add _data/news.yml 
          
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ“° [Bot] Update daily Chinese AI news"
            git push
          else
            echo "No changes to commit."
          fi
